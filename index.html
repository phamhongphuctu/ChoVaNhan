<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cho và Nhận Miễn Phí</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js"></script>
    <style>
        /* Giữ nguyên style gốc */
    </style>
</head>
<body>
    <!-- Nội dung HTML giữ nguyên -->
    <header>
        <h1>Cho và Nhận Miễn Phí</h1>
        <div id="userGreeting" style="display: none;">
            <p>Chào, <span id="username"></span>!</p>
            <button onclick="logout()">Đăng xuất</button>
        </div>
    </header>
    <main>
        <div id="appContent" style="display: none;">
            <h2>Danh sách bài đăng</h2>
            <div id="postsContainer"></div>
            
            <h2>Đăng bài mới</h2>
            <form id="postForm">
                <input type="text" id="name" placeholder="Tên" required>
                <textarea id="content" rows="4" placeholder="Nội dung" required></textarea>
                <select id="type">
                    <option value="Cho">Cho</option>
                    <option value="Nhận">Nhận</option>
                </select>
                <input type="file" id="image" accept="image/*">
                <button type="submit">Đăng bài</button>
            </form>

            <h2>Bản đồ OpenStreetMap</h2>
            <div id="map"></div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Initialize Admin Account
        function initializeAdminAccount() {
            const usersRef = firebase.database().ref('users');
            usersRef.child('admin').set({ password: '1' });
        }

        // Load Posts from Firebase
        function loadPosts() {
            const postsRef = firebase.database().ref('posts');
            const postsContainer = document.getElementById('postsContainer');
            postsContainer.innerHTML = '';

            postsRef.on('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const post = childSnapshot.val();
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `
                        <img src="${post.image || 'https://via.placeholder.com/100'}" alt="Image">
                        <div class="card-content">
                            <h3>${post.type}: ${post.name}</h3>
                            <p>${post.content}</p>
                        </div>
                    `;
                    postsContainer.appendChild(div);
                });
            });
        }

        // Add Post to Firebase
        document.getElementById('postForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const type = document.getElementById('type').value;
            const content = document.getElementById('content').value;
            const imageFile = document.getElementById('image').files[0];

            const reader = new FileReader();
            reader.onload = function() {
                const imageBase64 = reader.result;
                const postsRef = firebase.database().ref('posts');
                postsRef.push({ name, type, content, image: imageBase64 });
                alert('Bài đăng đã được lưu!');
                loadPosts();
            };

            if (imageFile) {
                reader.readAsDataURL(imageFile);
            } else {
                const postsRef = firebase.database().ref('posts');
                postsRef.push({ name, type, content, image: 'https://via.placeholder.com/100' });
                alert('Bài đăng đã được lưu!');
                loadPosts();
            }
            document.getElementById('postForm').reset();
        });

        window.onload = function() {
            initializeAdminAccount();
            checkLogin();
            loadPosts();
            initMap();
        };

        // Giữ nguyên các hàm khác
    </script>
</body>
</html>

